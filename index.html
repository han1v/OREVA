<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>OREVA OCR â€“ Free Image to Text</title>

<!-- OCR -->
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

<!-- Cropper -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cropperjs@1.6.1/dist/cropper.min.css">
<script src="https://cdn.jsdelivr.net/npm/cropperjs@1.6.1/dist/cropper.min.js"></script>

<!-- PDF -->
<script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.min.js"></script>

<style>
body {
  margin: 0;
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: #0f172a;
  color: white;
  font-family: Arial, sans-serif;
  text-align: center;
}

.container {
  width: 90%;
  max-width: 500px;
}

img.logo {
  width: 80px;
  margin-bottom: 20px;
}

button {
  background-color: #2563eb;
  color: white;
  border: none;
  padding: 12px 24px;
  font-size: 16px;
  cursor: pointer;
  border-radius: 6px;
  margin-top: 10px;
}

textarea {
  width: 100%;
  height: 180px;
  margin-top: 20px;
  padding: 10px;
  border-radius: 6px;
  border: none;
  resize: none;
}

img#preview {
  width: 100%;
  max-height: 75vh;
  margin-top: 15px;
  border-radius: 8px;
}

.hidden {
  display: none;
}

.note {
  margin-top: 12px;
  font-size: 12px;
  opacity: 0.7;
}
</style>
</head>

<body>
<div class="container">

<img src="logo.png" class="logo" alt="OREVA logo">

<h1>OREVA OCR</h1>
<p>Camera â€¢ Gallery â€¢ Files â€¢ PDF</p>

<!-- Native camera + files + gallery + PDF -->
<input type="file" id="fileInput" accept="image/*,.pdf" capture>

<img id="preview" class="hidden">

<button id="okBtn" class="hidden">OK â€“ Use This</button>
<button id="extractBtn" class="hidden">Extract Text</button>

<textarea id="output" placeholder="Extracted text will appear here..."></textarea>

<div class="note">
ðŸ”’ All processing happens in your browser. No files are uploaded.
</div>

</div>

<script>
const fileInput = document.getElementById("fileInput");
const preview = document.getElementById("preview");
const okBtn = document.getElementById("okBtn");
const extractBtn = document.getElementById("extractBtn");
const output = document.getElementById("output");

let cropper;
let finalImage;

// Handle file / camera / gallery / PDF
fileInput.addEventListener("change", async () => {
  const file = fileInput.files[0];
  if (!file) return;

  // If PDF
  if (file.type === "application/pdf") {
    const reader = new FileReader();
    reader.onload = async function () {
      const pdf = await pdfjsLib.getDocument(reader.result).promise;
      const page = await pdf.getPage(1);
      const viewport = page.getViewport({ scale: 2 });
      const canvas = document.createElement("canvas");
      const ctx = canvas.getContext("2d");
      canvas.width = viewport.width;
      canvas.height = viewport.height;
      await page.render({ canvasContext: ctx, viewport }).promise;
      preview.src = canvas.toDataURL("image/PNG");
      startCrop();
    };
    reader.readAsArrayBuffer(file);
  } else {
    preview.src = URL.createObjectURL(file);
    startCrop();
  }
});

function startCrop() {
  preview.classList.remove("hidden");
  okBtn.classList.remove("hidden");

  if (cropper) cropper.destroy();
  cropper = new Cropper(preview, {
    viewMode: 1,
    autoCropArea: 1
  });
}

// Confirm crop
okBtn.addEventListener("click", () => {
  finalImage = cropper.getCroppedCanvas();
  cropper.destroy();
  okBtn.classList.add("hidden");
  extractBtn.classList.remove("hidden");
});

// OCR
extractBtn.addEventListener("click", () => {
  extractBtn.textContent = "Extracting...";
  Tesseract.recognize(finalImage, "eng")
    .then(({ data: { text } }) => {
      output.value = text;
      extractBtn.textContent = "Extract Text";
    })
    .catch(() => {
      alert("OCR failed. Try a clearer image.");
      extractBtn.textContent = "Extract Text";
    });
});
</script>

</body>
</html>
